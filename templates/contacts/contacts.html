{% extends 'base.html' %}
{% load contact_filters %}

{% block title %}{{ contacts_text.header_title|default:'–ö–æ–Ω—Ç–∞–∫—Ç—ã' }} - {{ site_settings.site_title|default:'–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–∞—è
–∫–ª–∏–Ω–∏–∫–∞' }}{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="page-header-section">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-2">
                <li class="breadcrumb-item"><a href="{% url 'home' %}">{{ common_phrases.nav_home|default:'–ì–ª–∞–≤–Ω–∞—è'
                        }}</a></li>
                <li class="breadcrumb-item active">{{ common_phrases.nav_contacts|default:'–ö–æ–Ω—Ç–∞–∫—Ç—ã' }}</li>
            </ol>
        </nav>
        <h1><i class="bi bi-geo-alt"></i> {{ contacts_text.header_title|default:'–ö–æ–Ω—Ç–∞–∫—Ç—ã' }}</h1>
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="row">
            <div class="col-lg-5 mb-4 mb-lg-0">
                <h2 class="mb-4">{{ contacts_text.header_title|default:'–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏' }}</h2>

                {% if contact_info %}
                <div class="contact-info-card mb-4">
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-building"></i>
                        </div>
                        <div class="contact-content">
                            <h4>{{ common_phrases.label_clinic|default:'–ö–ª–∏–Ω–∏–∫–∞' }}</h4>
                            <p>{{ contact_info.clinic_name }}</p>
                        </div>
                    </div>

                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-geo-alt"></i>
                        </div>
                        <div class="contact-content">
                            <h4>{{ common_phrases.label_address|default:'–ê–¥—Ä–µ—Å' }}</h4>
                            <p>{{ contact_info.address }}</p>
                        </div>
                    </div>

                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-telephone"></i>
                        </div>
                        <div class="contact-content">
                            <h4>{{ common_phrases.label_phone|default:'–¢–µ–ª–µ—Ñ–æ–Ω' }}</h4>
                            <a href="tel:{{ contact_info.phone|phone_url }}">{{ contact_info.phone }}</a>
                        </div>
                    </div>

                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-envelope"></i>
                        </div>
                        <div class="contact-content">
                            <h4>{{ common_phrases.label_email|default:'Email' }}</h4>
                            <a href="mailto:{{ contact_info.email }}">{{ contact_info.email }}</a>
                        </div>
                    </div>

                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="bi bi-clock"></i>
                        </div>
                        <div class="contact-content">
                            <h4>{{ common_phrases.label_working_hours|default:'–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã' }}</h4>
                            <p>{{ contact_info.working_hours }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}

                <a href="{% url 'contacts:contact_us' %}" class="btn btn-primary btn-lg w-100">
                    <i class="bi bi-envelope"></i> {{ common_phrases.write_us_btn|default:'–ù–∞–ø–∏—Å–∞—Ç—å –Ω–∞–º' }}
                </a>
            </div>

            <div class="col-lg-7">
                <h2 class="mb-4">{{ common_phrases.how_to_find_us|default:'–ö–∞–∫ –Ω–∞—Å –Ω–∞–π—Ç–∏' }}</h2>

                {% if contact_info.has_coordinates %}
                <!-- –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç–∞ —á–µ—Ä–µ–∑ JavaScript API -->
                <div id="yandex-map" class="map-container"></div>
                {% elif contact_info and contact_info.yandex_map_embed_code %}
                <!-- Fallback: embed-–∫–æ–¥ -->
                <div class="map-container">
                    {{ contact_info.yandex_map_embed_code|safe }}
                </div>
                {% else %}
                <div class="map-container bg-light d-flex align-items-center justify-content-center">
                    <div class="text-center text-muted">
                        <i class="bi bi-map" style="font-size: 4rem;"></i>
                        <p class="mt-2">{{ common_phrases.map_coming_soon|default:'–ö–∞—Ä—Ç–∞ —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è' }}</p>
                    </div>
                </div>
                {% endif %}

                <div class="card mt-4">
                    <div class="card-body">
                        <h5><i class="bi bi-signpost-2 text-primary"></i> {{
                            common_phrases.how_to_get_there|default:'–ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è' }}</h5>
                        <p class="mb-2"><strong>{{ common_phrases.by_bus|default:'–ù–∞ –∞–≤—Ç–æ–±—É—Å–µ' }}:</strong> {{
                            contacts_text.by_bus|default:'–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ "—É–ª–∏—Ü–∞ –õ–µ–Ω–∏–Ω–∞"' }}</p>
                        <p class="mb-2"><strong>{{ common_phrases.by_car|default:'–ù–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ' }}:</strong> {{
                            contacts_text.by_car|default:'–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞ —É –∫–ª–∏–Ω–∏–∫–∏' }}</p>
                        {% if contact_info %}
                        <p class="mb-0"><strong>{{ common_phrases.label_address|default:'–ê–¥—Ä–µ—Å' }}:</strong> {{
                            contact_info.address }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
{% load l10n %}
{% if contact_info.has_coordinates %}
<!-- –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã JavaScript API -->
<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
<script type="text/javascript">
    ymaps.ready(initMap);

    function initMap() {
        {% localize off %}
        var coordinates = [{{ contact_info.latitude }}, { { contact_info.longitude } }];
    var zoom = {{ contact_info.map_zoom|default: 16 }};
    {% endlocalize %}

    var myMap = new ymaps.Map("yandex-map", {
        center: coordinates,
        zoom: zoom,
        controls: ['zoomControl', 'fullscreenControl', 'geolocationControl']
    });

    // –°–æ–∑–¥–∞—ë–º –º–µ—Ç–∫—É —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º
    var myPlacemark = new ymaps.Placemark(coordinates, {
        hintContent: '{{ contact_info.clinic_name }}',
        balloonContentHeader: '<strong style="font-size: 16px;">{{ contact_info.clinic_name }}</strong>',
        balloonContentBody:
            '<div style="padding: 5px 0;">' +
            '<p style="margin: 8px 0; font-size: 14px;">üìç {{ contact_info.address }}</p>' +
            '<p style="margin: 8px 0; font-size: 14px;">üìû <a href="tel:{{ contact_info.phone|phone_url }}">{{ contact_info.phone }}</a></p>' +
            '<p style="margin: 8px 0; font-size: 14px;">üïê {{ contact_info.working_hours }}</p>' +
            '</div>',
        balloonContentFooter: '{% localize off %}<a href="https://yandex.ru/maps/?rtext=~{{ contact_info.latitude }},{{ contact_info.longitude }}" target="_blank" style="display: inline-block; padding: 8px 16px; background: #0891b2; color: white; text-decoration: none; border-radius: 6px; font-size: 13px;">üöó –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç</a>{% endlocalize %}'
    }, {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π preset - –∫—Ä–∞—Å–Ω–∞—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∏–∫–æ–Ω–∫–∞
        preset: 'islands#redMedicalIcon'
    });

    myMap.geoObjects.add(myPlacemark);

    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –±–∞–ª—É–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    myPlacemark.balloon.open();

    // –û—Ç–∫–ª—é—á–∞–µ–º —Å–∫—Ä–æ–ª–ª –∫–∞—Ä—Ç—ã, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª –ø—Ä–æ–∫—Ä—É—Ç–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    myMap.behaviors.disable('scrollZoom');
    }
</script>
{% endif %}
{% endblock %}